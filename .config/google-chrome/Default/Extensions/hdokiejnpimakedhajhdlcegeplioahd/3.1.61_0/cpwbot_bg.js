var CPWbot_bg;CPWbot_bg||(CPWbot_bg=new CPWbot_bg_lib);
var TYPE_ID="id",TYPE_NAME="name",TYPE_XPATH="xpath",FN_LOGIN=1,FN_PASSWORD=2,FN_LOGIN_OTHER=5,FN_CURRENT_PASS=10,FN_NEW_PASS=11,FN_NEW_PASS_CONFIRM=12,FN_CPW_OTHER=13,FN_CPW_INVALID=14,FN_LOGIN_INVALID=15,FN_LOGIN_SUCCESS=16,FN_LOGIN_SUCCESS_INVALID=17,FN_NAVIGATE_TO_CPW=18,FN_CPW_SUCCESS=19,FN_CPW_SUCCESS_INVALID=20,FN_NAVIGATE_TO_ACCTMGMT=21,FN_CPW_SUBMIT=22,FN_IS_LOGGED_IN=23,FN_IS_LOGGED_IN_NEGATION=24,FN_LOGIN_SUBMIT=25,FN_POPUP_EXISTS=26,FN_POPUP_DISMISS=27,FN_REVEAL_LOGIN=28,FN_CHALLENGE_LOGIN=
29,FN_CHALLENGE_PASSWORD=30,FN_CHALLENGE_OTHER=31,FN_CHALLENGE_SUBMIT=32,JS_PRE_NAVIGATE_CPW=1,JS_PRE_LOGIN=2,JS_POST_NAVIGATE_CPW=3,JS_POST_LOGIN=4,JS_PRE_CPW=5,JS_POST_CPW=6,JS_PRE_ACCTMGMT=7,JS_POST_ACCTMGMT=8,JS_LOGIN_REVEAL=9,JS_VALIDATE_LOGIN_SUCCESS=10,JS_VALIDATE_CPW_SUCCESS=11,JS_LOGIN_SUBMIT=12,JS_FINISH=13,DEFAULT_CLICK_DELAY=250,DEFAULT_SESSION_TIMEOUT=6E4,DEFAULT_VALIDATE_TIMEOUT=5E3,recipe_template={symbolic:"",login_url:"",acctmgmt_url:null,cpw_url:"",validate_timeout:5E3,field_info:[],
jsfrags:[],cpw_delay:250,login_delay:250,acctmgmt_delay:250,cpw_change_success_url:null,cpw_change_failure_url:null,login_failure_url:null,login_success_url:null,generate_pref_overrides:null,reveal_login_js_delay:0,reveal_cpw_js_delay:0,navigate_acctmgmt_js_delay:0,postreveallogin_sleep:0,postacctmgmt_sleep:0,postrevealcpw_sleep:0,posttrigger_sleep:0,session_timeout:6E4,document_complete_timeout:0},fbfb={symbolic:"Facebook",login_url:"https://www.facebook.com/login.php",acctmgmt_url:null,cpw_url:"https://www.facebook.com/settings?tab=account&section=password&view",
validate_timeout:7500,cpw_delay:1050,login_delay:1050,field_info:[{id_type:TYPE_ID,id_value:"email",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"pass",id_function:FN_PASSWORD},{id_type:TYPE_NAME,id_value:"login",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'login_error_box')]/div",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//a[contains(@href,'/login.php')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"password_old",
id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"password_new",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"password_confirm",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//label[contains(@class, 'uiButtonConfirm')]",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//form[contains(@action,'https://www.facebook.com/ajax/login/password/change_reason/dialog')]",id_function:FN_CPW_SUCCESS},{id_type:TYPE_XPATH,id_value:"//span[contains(@class,'fbSettingsErrorMessage')]",
id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_NAME,id_value:"login",id_function:FN_IS_LOGGED_IN_NEGATION}],jsfrags:[{jstype:JS_FINISH,jsfrag:"var _btns = document.getElementsByClassName('layerCancel');  if (_btns.length>0) { _btns[0].click(); }"},{jstype:JS_POST_LOGIN,jsfrag:"var _rads = document.getElementsByNames('name_action_selected'); if (_rads.length > 1) { _rads[1].click(); var _btn = document.getElementById('checkpointSubmitButton');  if (_btn) { _btn.click(); } }"},{jstype:JS_PRE_NAVIGATE_CPW,
jsfrag:"var _rads = document.getElementsByNames('name_action_selected'); if (_rads.length > 1) { _rads[1].click(); var _btn = document.getElementById('checkpointSubmitButton');  if (_btn) { _btn.click(); } }"}],generate_pref_overrides:{minlength:6}},gmgm={symbolic:"Google Mail",login_url:"https://accounts.google.com/ServiceLogin?sacu=0",acctmgmt_url:null,cpw_url:"https://accounts.google.com/b/0/EditPasswd?hl=en",validate_timeout:5E3,cpw_delay:250,login_delay:250,field_info:[{id_type:TYPE_ID,id_value:"Email",
id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"Passwd",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"signIn",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_ID,id_value:"errormsg_0_Passwd",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"errormsg_0_Email",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"OldPasswd",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"Passwd",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"PasswdAgain",id_function:FN_NEW_PASS_CONFIRM},
{id_type:TYPE_ID,id_value:"save",id_function:FN_CPW_SUBMIT},{id_type:TYPE_ID,id_value:"errormsg_0_Passwd",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"errormsg_0_OldPasswd",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"errormsg_0_PasswdAgain",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_NAME,id_value:"signIn",id_function:FN_IS_LOGGED_IN_NEGATION}],jsfrags:[]},tmtm={symbolic:"Tumblr",login_url:"https://www.tumblr.com/login",cpw_url:null,acctmgmt_url:"https://www.tumblr.com/settings/account",
validate_timeout:1E4,field_info:[{id_type:TYPE_ID,id_value:"signup_email",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"signup_password",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//span[contains(@class,'login_btn')]",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//ul[@id='signup_form_errors']/li[contains(@class,'error')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='changepassword']/div/button[contains(@class,'edit')]",id_function:FN_NAVIGATE_TO_CPW},
{id_type:TYPE_ID,id_value:"password_current",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"password_new",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"password_confirm",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//div[@id='changepassword']//button[contains(@class,'accordion_save')]",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'error_tag')]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"logout_button",id_function:FN_IS_LOGGED_IN}],
jsfrags:[{jstype:JS_PRE_CPW,jsfrag:"var elt = document.getElementById('password_confirm'); if (elt) { elt.parentNode.parentNode.style.display='inline'; elt.click();  elt.value=' '; } elt = document.getElementById('password_new'); var tt = document.getElementById('tfa_password'); if (tt) { tt.style.display='none'; } if (elt) { elt.value=' '; elt.click(); }"}]},twtw={symbolic:"Twitter",login_url:"https://twitter.com/login",acctmgmt_url:null,cpw_url:"https://twitter.com/settings/password",validate_timeout:1E4,
field_info:[{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'clearfix')]/input[@name='session[username_or_email]']",id_function:FN_LOGIN},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'clearfix')]/input[@name='session[password]']",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//button[contains(@class, 'submit') and @type='submit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_ID,id_value:"current_password",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"user_password",id_function:FN_NEW_PASS},
{id_type:TYPE_ID,id_value:"user_password_confirmation",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"settings_save",id_function:FN_CPW_SUBMIT},{id_type:TYPE_NAME,id_value:"session[username_or_email]",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_NAME,id_value:"session[password]",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"global-actions",id_function:FN_IS_LOGGED_IN}],cpw_delay:250,login_delay:250,cpw_change_success_url:"https://twitter.com/settings/passwords/password_reset_confirmation",
login_failure_url:"https://twitter.com/login/error"},huhu={symbolic:"Houston Chronicle",login_url:"http://reg.chron.com/login",acctmgmt_url:"http://reg.chron.com/users/",cpw_url:null,validate_timeout:1E4,cpw_delay:1050,login_delay:1050,field_info:[{id_type:TYPE_ID,id_value:"email",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//form[@action='/session']/div/input[@name='commit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//a[@href='/logout']",
id_function:FN_LOGIN_SUCCESS},{id_type:TYPE_XPATH,id_value:"//a[@href='/login']",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//a[@href='/signup']",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"verify_password",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"user_password",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"user_password_confirmation",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//form[@id='change_password']//input[@id='user_submit']",
id_function:FN_CPW_SUBMIT},{id_type:TYPE_ID,id_value:"flash-notice",id_function:FN_CPW_SUCCESS},{id_type:TYPE_ID,id_value:"flash-error",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"change_password",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"verify_password",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//a[@href='/logout']",id_function:FN_IS_LOGGED_IN}],jsfrags:[],cpw_change_success_url:"https://reg.chron.com/login"},amam={symbolic:"Amazon",
login_url:"https://www.amazon.com/ap/cnep?_encoding=UTF8&openid.assoc_handle=usflex&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.mode=checkid_setup&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.ns.pape=http%3A%2F%2Fspecs.openid.net%2Fextensions%2Fpape%2F1.0&openid.pape.max_auth_age=0&openid.return_to=https%3A%2F%2Fwww.amazon.com%2Fgp%2Fcss%2Fhomepage.html%3Fie%3DUTF8%26ref_%3Dya_cnep",
cpw_url:null,acctmgmt_url:"https://www.amazon.com/ap/cnep?_encoding=UTF8&openid.assoc_handle=usflex&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.mode=checkid_setup&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&openid.ns.pape=http%3A%2F%2Fspecs.openid.net%2Fextensions%2Fpape%2F1.0&openid.pape.max_auth_age=0&openid.return_to=https%3A%2F%2Fwww.amazon.com%2Fgp%2Fcss%2Fhomepage.html%3Fie%3DUTF8%26ref_%3Dya_cnep",
validate_timeout:1E4,field_info:[{id_type:TYPE_NAME,id_value:"email",id_function:FN_LOGIN},{id_type:TYPE_NAME,id_value:"password",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"ap_signin1a_signin_button_row",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_ID,id_value:"message_error",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"cnep_1A_change_password_button-input",id_function:FN_NAVIGATE_TO_CPW},{id_type:TYPE_ID,id_value:"ap_password",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,
id_value:"ap_password_new",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"ap_password_new_check",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"cnep_1D_submit_button-input",id_function:FN_CPW_SUBMIT},{id_type:TYPE_ID,id_value:"message_error",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_NAME,id_value:"email",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_NAME,id_value:"password",id_function:FN_IS_LOGGED_IN_NEGATION}],jsfrags:[]},redditj={symbolic:"reddit",login_url:"https://ssl.reddit.com/login",
cpw_url:"https://ssl.reddit.com/prefs/update/",field_info:[{id_type:TYPE_NAME,id_value:"user_login",id_function:FN_LOGIN},{id_type:TYPE_NAME,id_value:"passwd_login",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//form[@id='login_login']//button[@type='submit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//form[@id='login_login-main']/div[contains(@class,'error')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//form[@id='login_login']/span[contains(@class,'error')]",
id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//form[contains(@class,'logout') and contains(@action,'/logout')]",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_XPATH,id_value:"//form[@id='pref-update-password']//input[@name='curpass']",id_function:FN_CURRENT_PASS},{id_type:TYPE_NAME,id_value:"newpass",id_function:FN_NEW_PASS},{id_type:TYPE_NAME,id_value:"verpass",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//form[@id='pref-update-password']/button[@type='submit']",
id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//form[@id='pref-update-password']//span[contains(@class,'WRONG_PASSWORD') and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//form[@id='pref-update-password']//span[contains(@class,'status') and contains(@style,'inline') and(text()!='')]",id_function:FN_CPW_SUCCESS}],jsfrags:[]},ebay={symbolic:"ebay",login_url:"https://signin.ebay.com/ws/eBayISAPI.dll?ChangePasswordAndCreateHint",field_info:[{id_type:TYPE_ID,
id_value:"userid",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"pass",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"sgnBt",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//span[@id='errf' and(text()!='')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"userid",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"pass",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"opass",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_ID,id_value:"opass",
id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"npass",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"rpass",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//button[@type='submit' and contains(@class, 'SIActBtn')]",id_function:FN_CPW_SUBMIT}],cpw_success_url:"&ssPageName=successPassword",cpw_failure_url:"https://scgi.ebay.com/ws/eBayISAPI.dll",reveal_cpw_js_delay:1,login_delay:1E3,jsfrags:[],generate_pref_overrides:{minlength:6,maxlength:64,digits:1,mindigits:1}},espn=
{symbolic:"ESPN (disney/go.com)",login_url:"http://www.espn.com",acctmgmt_url:"",cpw_url:"",validate_timeout:5E3,cpw_delay:2500,postreveallogin_sleep:2E3,postacctmgmt_sleep:2500,postrevealcpw_sleep:2E3,posttrigger_sleep:1500,navigate_acctmgmt_js_delay:1,field_info:[{id_type:TYPE_ID,id_value:"username",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"submitBtn",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[@id='signin']//a[contains(@class,  'cbOverlay')]",
id_function:FN_NAVIGATE_TO_ACCTMGMT},{id_type:TYPE_XPATH,id_value:"//div[@id=passwordfieldError and contains(@class, 'msg-err') and not(contains(@style, 'none'))]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id=usernamefieldError and contains(@class, 'msg-err') and not(contains(@style, 'none'))]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"oldPassword",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"password",id_function:FN_NEW_PASS},{id_type:TYPE_ID,
id_value:"gspwConfirm",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"saveNamePW",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[@id='oldPasswordEditError' and contains(@class, 'msg-err') and not(contains(@style, 'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='oldPasswordEditError' and contains(@style, 'msg-err') and not(contains(@style, 'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='newPasswordEditError' and contains(@style, 'msg-err') and not(contains(@style, 'none'))]",
id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='content-namepw-edit' and not(contains(@style, 'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='signin']//a[contains(@onclick, 'espn.memberservices.logout()')]",id_function:FN_IS_LOGGED_IN}],jsfrags:[{jstype:JS_LOGIN_REVEAL,jsfrag:"var _elt = document.getElementById('personalizationLink'); if (_elt) { _elt.click(); } "},{jstype:JS_PRE_CPW,jsfrag:"var _edt = document.getElementById('editNamePW'); if (_edt) { _edt.click(); } "},
{jstype:JS_POST_NAVIGATE_CPW,jsfrag:"var _edt = document.getElementById('editNamePW'); if (_edt) { _edt.click(); } "},{jstype:JS_POST_ACCTMGMT,jsfrag:"var _inf = document.getElementById('accountInfo'); if (_inf) { document.location.href = 'https://r.espn.go.com/members/v3_1/modifyAccount?language=en&parentLocation=http%3A%2F%2Fespn.go.com%2F'; }"},{jstype:JS_PRE_NAVIGATE_CPW,jsfrag:"var _edt = document.getElementById('editNamePW'); if (_edt) { _edt.click(); } "},{jstype:JS_POST_CPW,jsfrag:"var _fm = document.getElementById('namePassWordForm'); if (_fm) { _fm.focus(); _fm.click(); } "}],
generate_pref_overrides:{minlength:6}},wapo={symbolic:"Washington Post",login_url:"https://account.washingtonpost.com/actmgmt/registration/login-only?nextstep=https%3A%2F%2Faccount.washingtonpost.com%2Factmgmt%2Fprofile%2Fshow",acctmgmt_url:"https://account.washingtonpost.com/actmgmt/profile/show",cpw_url:"",field_info:[{id_type:TYPE_ID,id_value:"username",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//form[@name='form']//button[@type='submit']",
id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'main-wrapper')]//li[contains(@class,'signed-out') and contains(@style,'none')]",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'main-wrapper')]//li[contains(@class,'signed-in') and not(contains(@style,'none'))]",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_XPATH,id_value:"//li[contains(@data-bind,'onChangePassword')]",id_function:FN_NAVIGATE_TO_CPW},{id_type:TYPE_NAME,id_value:"currentPassword",
id_function:FN_CURRENT_PASS},{id_type:TYPE_NAME,id_value:"newPassword",id_function:FN_NEW_PASS},{id_type:TYPE_NAME,id_value:"confirmPassword",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//form[contains(@class, 'change-password')]//button[contains(@data-bind,'saveButtonText')]",id_function:FN_CPW_SUBMIT},{id_type:TYPE_NAME,id_value:"newPassword",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//form[contains(@class, 'change-password')]//button[contains(@data-bind,'saveButtonText')]",
id_function:FN_CPW_SUCCESS_INVALID}],jsfrags:[],login_failure_url:"https://account.washingtonpost.com/actmgmt/registration/login-only",generate_pref_overrides:{minlength:8},posttrigger_sleep:1500},kos={symbolic:"Daily Kos",login_url:"https://www.dailykos.com/users/sign_in",acctmgmt_url:"",cpw_url:"",field_info:[{id_type:TYPE_ID,id_value:"user_login",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"user_password",id_function:FN_PASSWORD},{id_type:TYPE_NAME,id_value:"commit",id_function:FN_LOGIN_SUBMIT},
{id_type:TYPE_ID,id_value:"login_form",id_function:FN_LOGIN_OTHER},{id_type:TYPE_ID,id_value:"user_login",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"user_password",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_XPATH,id_value:"//div[@id='header-authorization']/a[contains(@href,'/logout')]",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_XPATH,id_value:"//div[@id='header-authorization']/a[contains(@class,'logged-in')]",id_function:FN_NAVIGATE_TO_ACCTMGMT},{id_type:TYPE_XPATH,
id_value:"//a[contains(@href, '/user/') and contains(@href, '/edit')]",id_function:FN_NAVIGATE_TO_CPW},{id_type:TYPE_ID,id_value:"user_current_password",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"user_password",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"user_password_confirmation",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//form[@id='edit_user' and contains(@class,'edit_user')]//input[@name='commit']",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[@id='inner-container']/div[contains(@class,'error')]",
id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='inner-container']/div/p[contains(@class,'success')]",id_function:FN_CPW_SUCCESS}],reveal_cpw_js_delay:1,validate_timeout:1E4,login_failure_url:"https://www.dailykos.com/users/sign_in",jsfrags:[{jstype:JS_POST_NAVIGATE_CPW,jsfrag:"var _ff = document.getElementById('edituser'); if (_ff) { var _elts = _ff.getElementsByTagName('A');  if (_elts.length>0) { _elts[0].click(); } } "},{jstype:JS_PRE_LOGIN,jsfrag:"var _ad = document.getElementById('ad-close'); if (_ad) { _ad.click(); } "},
{jstype:JS_PRE_NAVIGATE_CPW,jsfrag:"var _ad = document.getElementById('ad-close'); if (_ad) { _ad.click(); } "}],generate_pref_overrides:{minlength:6},document_complete_timeout:2E3},nordstrom={symbolic:"Nordstrom",login_url:"https://secure.nordstrom.com/SignIn.aspx?ReturnURL=http%3a%2f%2fshop.nordstrom.com%2f&origin=tab",acctmgmt_url:"https://secure.nordstrom.com/myaccount/accountsummary.aspx",cpw_url:null,field_info:[{id_type:TYPE_ID,id_value:"ctl00_mainContentPlaceHolder_signIn_email",id_function:FN_LOGIN},
{id_type:TYPE_ID,id_value:"ctl00_mainContentPlaceHolder_signIn_password",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"ctl00_mainContentPlaceHolder_signIn_enterButton",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_mainContentPlaceHolder_signIn_validatorEmailAddressRequired' and not(contains(@style,'none'))]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_mainContentPlaceHolder_signIn_validatorEmailAddressValid' and not(contains(@style,'none'))]",
id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_mainContentPlaceHolder_signIn_validatorPasswordRequired' and not(contains(@style,'none'))]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//li[@id='shopper-status']//a[contains(@href, 'SignIn.aspx')]",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"GlobalSignOutLink",id_function:FN_IS_LOGGED_IN},{id_type:TYPE_ID,id_value:"ctl00_mainContentPlaceHolder_signIn_password",id_function:FN_IS_LOGGED_IN_NEGATION},
{id_type:TYPE_ID,id_value:"ctl00_mainContentPlaceHolder_SignInNordUserControl_editSigninChangePassword",id_function:FN_NAVIGATE_TO_CPW},{id_type:TYPE_ID,id_value:"ctl00_EndOfDomContent_changePasswordModal_currentPasswordTextBox",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"ctl00_EndOfDomContent_changePasswordModal_passwordTextBox",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"ctl00_EndOfDomContent_changePasswordModal_passwordConfirmTextBox",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,
id_value:"//a[contains(@onclick, 'Change Account Password')]",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_EndOfDomContent_changePasswordModal_validatorCurrentPasswordRequired' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_EndOfDomContent_changePasswordModal_validatorPassword1Required' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_EndOfDomContent_changePasswordModal_textBoxValidator2' and not(contains(@style,'none'))]",
id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_EndOfDomContent_changePasswordModal_validatorPassword2Required' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//span[@id='ctl00_EndOfDomContent_changePasswordModal_validatorConfirmPasswordMatch' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//div[@id='ctl00_EndOfDomContent_changePasswordModal_Modal' and contains(@style,'none')]",
id_function:FN_CPW_SUCCESS}],jsfrags:[{jstype:JS_POST_ACCTMGMT,jsfrag:"var _elt = document.getElementById('ctl00_mainContentPlaceHolder_leftMenu_LinkSignIn'); if (_elt) { _elt.click(); }"}],cpw_delay:250,reveal_cpw_js_delay:1,postacctmgmt_sleep:1E3,postrevealcpw_sleep:1E3,validate_timeout:1E4,document_complete_timeout:2E3,generate_pref_overrides:{minlength:7,digits:1,mindigits:1}},pizzahut={symbolic:"Pizza Hut",login_url:"https://order.pizzahut.com/site/dashboard",cpw_url:"",acctmgmt_url:"",field_info:[{id_type:TYPE_ID,
id_value:"lw-email",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"login-pw",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:"login-submit",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'alertOverlay')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"nav_signout",id_function:FN_LOGIN_SUCCESS},{id_type:TYPE_ID,id_value:"header-sign-in",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"nav_signout",id_function:FN_IS_LOGGED_IN},
{id_type:TYPE_ID,id_value:"edit-account",id_function:FN_NAVIGATE_TO_ACCTMGMT},{id_type:TYPE_ID,id_value:"ea-change-password",id_function:FN_NAVIGATE_TO_CPW},{id_type:TYPE_ID,id_value:"ea-current-pw",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"ea-new-pw",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"ea-confirm-pw",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"ea-submit",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[@id='ea-pw-on' and contains(@style, 'block')]",
id_function:FN_CPW_OTHER},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'alertOverlay')]",id_function:FN_CPW_SUCCESS_INVALID}],jsfrags:[{jstype:JS_LOGIN_REVEAL,jsfrag:"var _elt = document.getElementById('header-sign-in'); if (_elt) { _elt.click(); }"}],postacctmgmt_sleep:1500,postrevealcpw_sleep:1500,generate_pref_overrides:{minlength:6,digits:1,mindigits:1,special:0}},yahoo={symbolic:"Yahoo",login_url:"https://edit.yahoo.com/config/change_pw",cpw_delay:250,field_info:[{id_type:TYPE_ID,id_value:"username",
id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"passwd",id_function:FN_PASSWORD},{id_type:TYPE_ID,id_value:".save",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'yregertxt')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_ID,id_value:"username",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"usernameP",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"passwd",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_ID,id_value:"password",
id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"password-confirm",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"primary-cta",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//p[@id='password-confirm-message' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//p[@id='password-message' and not(contains(@style,'none'))]",id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//form[@id='change-password-form']/div[contains(@class,'input-container')]",
id_function:FN_CPW_SUCCESS},{id_type:TYPE_XPATH,id_value:"//div[@id='inputs']/p[@id='usernameP']",id_function:FN_CPW_SUCCESS_INVALID}],jsfrags:[]},bild={symbolic:"Das Bild",login_url:"https://don.bild.de/www/li/http%253A%252F%252Fwww.bild.de%252F",acctmgmt_url:"https://meinkonto.bild.de/web/",cpw_url:"https://secure.mypass.de/sso/web/profilpflege?service=https://meinkonto.bild.de/&profiltab=password",field_info:[{id_type:TYPE_ID,id_value:"username",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",
id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//input[@type='submit' and @name='_eventId_submit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_XPATH,id_value:"//form[@id='loginLayer']//div[contains(@class,'error-message')]/div[contains(@class,'error-text')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//p[@id='error-message']/span[contains(@class,'errormessage')]",id_function:FN_LOGIN_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//a[contains(@href,'meinkonto')]",
id_function:FN_IS_LOGGED_IN},{id_type:TYPE_ID,id_value:"webCredentials_currentPassword",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"webCredentials_newPassword1",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"webCredentials_newPassword2",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_XPATH,id_value:"//input[@type='submit' and @name='_eventId_updateWebCredentials']",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'error-box')]/p[contains(@style,'block')]",
id_function:FN_CPW_SUCCESS_INVALID},{id_type:TYPE_XPATH,id_value:"//p[contains(@class,'hint')and text()!='']",id_function:FN_CPW_SUCCESS}],generate_pref_overrides:{minlength:6},jsfrags:[]},fidelity={symbolic:"Fidelity (Retail)",login_url:"https://login.fidelity.com/ftgw/Fidelity/RtlCust/Login/init/",acctmgmt_url:null,cpw_url:"https://fps.fidelity.com/ftgw/Fps/Fidelity/RtlCust/ChangePIN/Init",field_info:[{id_type:TYPE_ID,id_value:"userId",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",
id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//button[@type='submit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_ID,id_value:"currentPIN",id_function:FN_CURRENT_PASS},{id_type:TYPE_ID,id_value:"newPIN",id_function:FN_NEW_PASS},{id_type:TYPE_ID,id_value:"retypeNewPIN",id_function:FN_NEW_PASS_CONFIRM},{id_type:TYPE_ID,id_value:"submitButton",id_function:FN_CPW_SUBMIT},{id_type:TYPE_XPATH,id_value:"//div[contains(@class,'errorMessage')]",id_function:FN_CPW_SUCCESS_INVALID}],jsfrag:[],generate_pref_overrides:{special:0,
minlength:6,maxlength:12}},amex={symbolic:"American Express",field_info:[],jsfrag:[]},boa={symbolic:"Bank of America",login_url:"https://www.bankofamerica.com/sitemap/hub/signin.go",field_info:[{id_type:TYPE_ID,id_value:"userId",id_function:FN_LOGIN},{id_type:TYPE_ID,id_value:"password",id_function:FN_PASSWORD}],jsfrag:[]},capitalone={generate_pref_overrides:{mindigits:2,digits:1,special:0}},capitalone360={},testrig={symbolic:"Test",login_url:"http://www.netrot.net/~chang/form/formtest1.html",field_info:[{id_type:TYPE_ID,
id_value:"email",id_function:FN_LOGIN},{id_type:TYPE_NAME,id_value:"password",id_function:FN_PASSWORD},{id_type:TYPE_XPATH,id_value:"//input[@type='submit']",id_function:FN_LOGIN_SUBMIT},{id_type:TYPE_ID,id_value:"email",id_function:FN_IS_LOGGED_IN_NEGATION},{id_type:TYPE_XPATH,id_value:"//input[@type='submit']",id_function:FN_CPW_SUBMIT}],jsfrag:[],generate_pref_overrides:{mindigits:1,digits:1,special:0,minlength:6}};
function CPWbot_bg_lib(){function v(a,c){if(!a||!a.field_info)return null;var b,d,e;for(b=0;b<a.field_info.length;b++)if(d=a.field_info[b],d.id_function==c){e={id_type:d.id_type,id_value:d.id_value};break}return e}function I(a){return x(a,JS_PRE_NAVIGATE_CPW)}function l(a){return x(a,JS_POST_NAVIGATE_CPW)}function q(a){return x(a,JS_PRE_ACCTMGMT)}function G(a){return x(a,JS_POST_ACCTMGMT)}function ha(a){return x(a,JS_PRE_CPW)}function ia(a){return x(a,JS_POST_CPW)}function ta(a){return x(a,JS_PRE_LOGIN)}
function ua(a){return x(a,JS_POST_LOGIN)}function ja(a){return x(a,JS_LOGIN_REVEAL)}function va(a){return x(a,JS_LOGIN_SUBMIT)}function wa(a){return x(a,JS_VALIDATE_LOGIN_SUCCESS)}function xa(a){return x(a,JS_VALIDATE_CPW_SUCCESS)}function ya(a){return x(a,JS_FINISH)}function za(a){var c=null;a&&"undefined"!=typeof a.cpw_change_success_url&&(c=a.cpw_change_success_url);return c}function Aa(a){var c=null;a&&"undefined"!=typeof a.cpw_change_failure_url&&(c=a.cpw_change_failure_url);return c}function Ba(a){var c=
null;a&&"undefined"!=typeof a.login_failure_url&&(c=a.login_failure_url);return c}function Ca(a){var c=null;a&&"undefined"!=typeof a.login_success_url&&(c=a.login_success_url);return c}function x(a,c){if(!a||!a.jsfrags)return null;var b,d,e;for(b=0;b<a.jsfrags.length;b++)if(d=a.jsfrags[b],d.jstype==c){e=d.jsfrag;break}return e}function y(a,c,b){return!c||!b?null:(c=b(c))?(g_isfirefox?this.alert("TODO"):(verbose_log("injecting javascript fragment into CS: "+c),sendCS(a,{cmd:"run_cpwbot_js",js:c},"all")),
!0):!1}function W(a){return"undefined"!=typeof g_sites?g_sites[a]:"undefined"!=typeof lpaccts?lpaccts[a]:null}function Da(a,c,b){if(!b)return!1;g_isfirefox?this.alert("TODO"):sendCS(a,{cmd:"cpwbot_fill_field",id_type:b.id_type,id_value:b.id_value,field_value:c,type:"text",formname:""},"all");return!0}function X(a,c,b){if(!b)return!1;g_isfirefox?this.alert("TODO"):sendCS(a,{cmd:"cpwbot_fill_field",id_type:b.id_type,id_value:b.id_value,field_value:c,type:"password",formname:""},"all");return!0}function Y(a,
c,b){if(!c)return!1;if("undefined"==typeof b||null===b)b=DEFAULT_CLICK_DELAY;var d=(new Date).getTime();null===d&&(d=0);d=SHA256(a.toString()+c.id_value+d.toString());verbose_log("click_field id="+d);Z=d;g_isfirefox?this.alert("TODO"):sendCS(a,{cmd:"cpwbot_click_field",msgid:d,pwchangestate:n,id_type:c.id_type,id_value:c.id_value,delay:b},"all");return!0}function ka(a,c,b){if(!c||!b)return!1;var d="",d="",e=W(b.aid);if(!e)return!1;y(a,c,ta);var g=v(c,FN_LOGIN);b=v(c,FN_PASSWORD);g&&(d=getusernamefromacct(e),
Da(a,d,g));b&&(d=getpasswordfromacct(e),X(a,d,b));y(a,c,ua);return!0}function la(a,c){if(!c)return!1;var b=!1;$=!1;var d=v(c,FN_LOGIN_SUBMIT);d&&(b=DEFAULT_CLICK_DELAY,"undefined"!=typeof c.login_delay&&(b=c.login_delay),$=!0,Y(a,d,b),b=!0);y(a,c,va)&&(b=!0);return b?null:!0}function A(a){verbose_log("entered cpwbot_cs_finish to clean up "+a);null!==t&&(t!=a?verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+a+" g_pwchangetabid="+t):g_isfirefox?pass:sendCS(a,
{cmd:"cpwbot_finish"}))}function Ea(a){var c=[],b=[FN_CPW_OTHER,FN_CURRENT_PASS,FN_NEW_PASS,FN_NEW_PASS_CONFIRM],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Fa(a){var c=[],b=[FN_CPW_INVALID],d,e;for(d=0;d<b.length;d++){var g=D(a,b[d]);if(g&&0<g.length)for(e=0;e<g.length;e++){var h=g[e];h&&c.push(h)}}return c}function Ga(a){var c=[],b=[FN_PASSWORD,FN_LOGIN_OTHER],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Ha(a){var c=
[],b=[FN_LOGIN_INVALID],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Ia(a){var c=[],b=[FN_LOGIN_SUCCESS],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Ja(a){var c=[],b=[FN_LOGIN_SUCCESS_INVALID],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Ka(a){var c=[],b=[FN_CPW_SUCCESS],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function La(a){var c=
[],b=[FN_CPW_SUCCESS_INVALID],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Ma(a){var c=[],b=[FN_IS_LOGGED_IN],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function Na(a){var c=[],b=[FN_IS_LOGGED_IN_NEGATION],d;for(d=0;d<b.length;d++){var e=D(a,b[d]);e&&0<e.length&&(c=c.concat(e))}return c}function D(a,c){var b=[];if(!a||!a.field_info)return b;var d,e;for(d=0;d<a.field_info.length;d++)e=a.field_info[d],e.id_function==
c&&(e={id_type:e.id_type,id_value:e.id_value},b.push(e));return b}function S(a,c,b){null===b&&(b=1);if(null===a||!c)return!1;var d=c.desc;b=c.recipe;var e=c.fn_url_failed,g=c.fn_url_success,h=c.fn_required;c=c.fn_rejected;T=N=!1;console.log("cpwbot check_tab_for_state for "+d);if(g_isfirefox)this.alert("TODO");else{h=h?h(b):[];c=c?c(b):[];var f=this.JSON.stringify(h),j=this.JSON.stringify(c);if(0==h.length&&0==c.length&&!g&&!e)return L("WARN: "+d+" has no field or url criteria defined to validate against"),
!0;c=DEFAULT_VALIDATE_TIMEOUT;b&&"undefined"!=typeof b.validate_timeout&&(h=parseInt(b.validate_timeout))&&!isNaN(h)&&(c=h);g=g?g(b):null;h=e?e(b):null;e=(new Date).getTime();null===e&&(e=0);var p=SHA256(a.toString()+d+e.toString());E=p;verbose_log("interrogate id="+E+" desc="+d);u=[];e={cmd:"cpwbot_validate_state",desc:d,required_fields:f,rejected_fields:j,id:E,validate_timeout:c,timestamp:e};g&&(e.required_url=g);h&&(e.rejected_url=h);B=e;J=d;g=0;b?("undefined"!=typeof b.session_timeout&&(g=b.session_timeout),
b=g):b=null;b||(b=DEFAULT_SESSION_TIMEOUT);sendCS(a,e,"all");verbose_log("setup setimeout for "+c/1E3+" seconds finish_cpwbot_validate_state");setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(a,p,f,j,d)},c);setTimeout(function(){console.error("SESSION TIMEOUT WAKEUP");!z&&!aa&&t==a?(s(w,"a change is still running and did not succeed or terminated early due to error? tabid="+a+"last state ="+n),CPWbot_bg.panic()):(A(a),CPWbot_bg.cpwbot_cs_finish_complete(a))},b);return null}}function O(){return null}
function ba(a,c){c?U=c:c=U;var b=this.JSON.stringify({msg:c});g_isfirefox?this.alert("todo"):sendCS(a,{cmd:"do_cpwbot_overlay",msg:b},g_CS_tops[a])}function ma(a){var c=0;if(!a)return null;"undefined"!=typeof a.postacctmgmt_sleep&&(c=a.postacctmgmt_sleep);return c}function na(a){var c=0;if(!a)return null;"undefined"!=typeof a.postrevealcpw_sleep&&(c=a.postrevealcpw_sleep);return c}function oa(a){var c=0;if(!a)return null;"undefined"!=typeof a.postreveallogin_sleep&&(c=a.postreveallogin_sleep);return c}
function pa(a){var c=!1;if(!a)return null;"undefined"!=typeof a.document_complete_timeout&&(c=a.document_complete_timeout);return c}function s(a,c){if(a<qa||a>w)a=qa;var b="["+["DEBUG","INFO","WARN","ERR"][a]+"] "+c+"\n";V+=b;verbose_log(b);return!0}function Oa(a){var c=document;if(!c||!a)return!1;var b,d;if(!(!a?0:a.login_url)||!a.symbolic||!a.field_info||0>=a.field_info.length)return!1;for(b=0;b<a.field_info.length;b++)if(d=a.field_info[b],d.id_type==TYPE_XPATH){var e;a:{var g=c,h=d.id_value,f=
!1;if(h&&g)try{var j=new XPathEvaluator;if(!j){L("NO XPATH EVALUATOR AVAILABLE ????");e=!0;break a}j.evaluate(h,g.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);f=!0}catch(p){console.error("error validating '"+h+"', exception: "+p),f=!1}e=f}if(!e||d.id_value&&0<d.id_value.indexOf("@clas,"))return!1}return!0}function ra(a,c){var b=c.docnum,d=c.url;if(null===k)return!1;(null===k[b]||"undefined"==typeof k[b])&&CPWbot_bg.clear_frame_score(a,b,d);k[b]+=2;return!0}function sa(a){if(null===
k||null===a)return 0;var c,b=0,d;for(d in CS_table)CS_table.hasOwnProperty(d)&&(c=CS_table[d],c.tabid===a&&(c=c.docnum,(CPWbot_bg.skip_frame_by_score(c)||skip_CS_by_score(a,c))&&b++));return b}var ca=0,n=null,t=null,K=null,H=null,P=0,B=null,E=null,J=null,ga=null,Z=null,U=null,u=[],da=!1,ea=!1,fa=!1,F=!1,V="",z=!1,aa=!1,M=!1,$=!1,Q=!1,R=!1,k={},N=!1,T=!1;"function"==typeof alertfrombg&&(this.alert=alertfrombg);g_isfirefox&&(this.alert=alert);this.JSON=JSON;JSON||(this.JSON=LPJSON);this.get_pwchangestate=
function(){return n};this.get_pwchangetabid=function(){return t};this.get_login_url=function(a){return!a?null:a.login_url};this.get_cpw_url=function(a){return!a?null:a.cpw_url};this.get_acctmgmt_url=function(a){return!a?null:a.acctmgmt_url};this.conditional_js_exec=function(a,c,b){return y(a,c,b)};this.show_cpwbot_overlay=function(a,c){return ba(a,c)};this.in_validate=function(){return B&&E&&J};this.get_last_overlay_message=function(){return U};this.reveal_cpw=function(a,c){var b=c.recipe,d=c.payload,
e=d.aid;L("reveal_cpw called after wait-for-document-complete tabid="+a);n="D";if(!b)return!1;ea=!1;y(a,b,I);var g=!b?null:b.cpw_url;if(g)if(g_isfirefox)CPWbot_bg.alert("TODO");else return L("call cpw:loadurl with "+g),e=null,g_CS_tops&&(e=g_CS_tops[a],g_ischrome&&0!=e&&L("loadurl is not sending to docnum==0 ! "+e)),sendCS(a,{cmd:"loadurl",url:g},e),H=b,K=d,ea=!0,!1;R=!1;if(d=v(b,FN_NAVIGATE_TO_CPW))verbose_log("click on FN_NAVIGATE_TO_CPW field!"),g=DEFAULT_CLICK_DELAY,"undefined"!=typeof b.cpw_delay&&
(g=b.cpw_delay),R=!0,L("now waiting for click_ack D"),Y(a,d,g);d=!1;b?"undefined"!=typeof b.reveal_cpw_js_delay&&(d=b.reveal_cpw_js_delay?!0:!1):d=null;if(d&&(ea=!0,na(b)))return!1;y(a,b,l);if(c.didcallout)return L("end of reveal_cpw thread with callout to CS - hack Dpickup to resume for aid="+e),CPWbot_bg.initiate(a,{aid:e,recipe:b},"Dpickup");L("no callout to CS, so reveal_cpw does not end thread, returning to initiate");return!0};this.navigate_to_acctmgmt=function(a,c){var b=c.recipe,d=c.payload,
e=d.aid;L("navigate_to_acctmgmt called after wait-for-document-complete tabid="+a);n="C";if(!b)return!1;fa=!1;y(a,b,q);var g=!b?null:b.acctmgmt_url;if(g)if(g_isfirefox)CPWbot_bg.alert("TODO");else return L("call acctmgmt:loadurl with "+g),e=null,g_CS_tops&&(e=g_CS_tops[a]),sendCS(a,{cmd:"loadurl",url:g},e),H=b,K=d,fa=!0,!1;Q=!1;if(d=v(b,FN_NAVIGATE_TO_ACCTMGMT))verbose_log("click on FN_NAVIGATE_TO_ACCTMGMT field!"),g=DEFAULT_CLICK_DELAY,"undefined"!=typeof b.acctmgmt_delay&&(g=b.acctmgmt_delay),Q=
!0,L("now waiting for click_ack C"),Y(a,d,g);d=!1;b?"undefined"!=typeof b.navigate_acctmgmt_js_delay&&(d=b.navigate_acctmgmt_js_delay?!0:!1):d=null;if(d&&(fa=!0,ma(b)))return!1;y(a,b,G);if(c.didcallout)return L("end of navigate_to_acctmgmt thread with callout to CS - hack Cpickup to resume for aid="+e),CPWbot_bg.initiate(a,{aid:e,recipe:b},"Cpickup");L("no callout to CS, so reveal_cpw does not end thread, returning to initiate");return!0};this.trigger_cpw=function(a,c){var b=c.recipe,d=c.payload;
L("trigger_cpw called after wait-for-document-complete tabid="+a);n="E";if(!b||!d)return!1;var e=d.aid,g=W(e);y(a,b,ha);var h=v(b,FN_CURRENT_PASS),f=v(b,FN_NEW_PASS),j=v(b,FN_NEW_PASS_CONFIRM),p=v(b,FN_CPW_SUBMIT),m,k=1,l=1,q=1,t=0,G=1,u=0,w=1,x=null;m=parseInt(lpGetPref("generate_length",15));var k=parseInt(lpGetPref("generate_upper",k)),l=parseInt(lpGetPref("generate_lower",l)),q=parseInt(lpGetPref("generate_digits",q)),t=parseInt(lpGetPref("generate_special",t)),G=parseInt(lpGetPref("generate_mindigits",
G)),u=parseInt(lpGetPref("generate_ambig",u)),w=parseInt(lpGetPref("generate_reqevery",w)),x=parseInt(lpGetPref("generate_pronounceable",x)),r;r=null;b&&"undefined"!=typeof b.generate_pref_overrides&&(r=b.generate_pref_overrides);null!==r&&("undefined"!=typeof r.length&&null!==r.length&&(m=r.length),"undefined"!=typeof r.maxlength&&null!==r.maxlength&&m>r.maxlength&&(m=r.maxlength),"undefined"!=typeof r.minlength&&null!==r.minlength&&m<r.minlength&&(m=r.minlength),"undefined"!=typeof r.special&&null!==
r.special&&(t=r.special?1:0),"undefined"!=typeof r.digits&&null!==r.digits&&(q=r.digits?1:0),"undefined"!=typeof r.upper&&null!==r.upper&&(k=r.upper?1:0),"undefined"!=typeof r.lower&&null!==r.lower&&(l=r.lower?1:0),"undefined"!=typeof r.mindigits&&null!==r.mindigits&&(G=r.mindigits));s(C,"Generating a new password that is "+m+" chars long, "+(k?"with":"without")+" uppercase chars, "+(l?"with":"without")+" lowercase chars, "+(q?"with":"without")+" numeric chars, "+(t?"with":"without")+" special chars, with at least "+
G+" numbers,");m=lpCreatePass(m,k,l,q,t,G,u,w,x);L("generated new password: "+(g_show_pw_in_logs||g_isadmin?m:"REDACTED"));k=getpasswordfromacct(g);L("saving "+(g_show_pw_in_logs||g_isadmin?m:"REDACTED")+" to "+g.url+" as generated password");savePassword(m,g.url,a,1);null!==g_genpws&&g_genpws.unshift(m);d.newpw=lpenc(m);d.curpw=lpenc(k);K=d;ga=d.newpw;h&&X(a,k,h);f&&X(a,m,f);j&&X(a,m,j);p&&(M=!0,L("now waiting for click_ack E"),Y(a,p));g_isfirefox?CPWbot_bg.alert("TODO"):pass;y(a,b,ia);if(c.didcallout)return L("end of trigger_cpw thread with callout to CS - hack Epickup to resume for aid="+
e),CPWbot_bg.initiate(a,{aid:e,recipe:b},"Epickup");L("no callout to CS, so trigger_cpw does not end thread, returning to initiate");return!0};this.navigate_to_login=function(a,c,b){n="B";da=!1;if(!c)return!1;var d=!c?null:c.login_url;if(d)if(g_isfirefox)CPWbot_bg.alert("TODO");else{L("call login:loadurl with "+d);var e=null;g_CS_tops&&(e=g_CS_tops[a],g_ischrome&&0!=e&&L("loadurl is not sending to docnum==0 ! "+e));sendCS(a,{cmd:"loadurl",url:d},e);H=c;K=b;da=!0;return!1}b=!1;c?"undefined"!=typeof c.reveal_login_js_delay&&
(b=c.reveal_login_js_delay?!0:!1):b=null;if(b&&(da=!0,oa(c)))return!1;y(a,c,ja);return!0};this.check_is_logged_in=function(a,c){if(!c)return!1;var b={recipe:c,desc:"validate_website_is_loggedin",fn_required:Ma,fn_rejected:Na,fn_url_success:O,fn_url_failed:O};if(CPWbot_bg.should_wait_for_document_complete(a,b))return CPWbot_bg.wait_for_doc_complete(a,null,S,b),null;L("validate_website_is_loggedin returns true, no wait ");return!0};this.validate_login_success=function(a,c){if(!c)return!1;y(a,c,wa);
var b={recipe:c,desc:"validate_login_success",fn_required:Ia,fn_rejected:Ja,fn_url_success:Ca,fn_url_failed:Ba};if(CPWbot_bg.should_wait_for_document_complete(a,b))return CPWbot_bg.wait_for_doc_complete(a,null,S,b),null;L("validate_login_success returns true, no wait ");return!0};this.validate_cpw_success=function(a,c){if(!c)return!1;y(a,c,xa);var b={recipe:c,desc:"validate_cpw_success",fn_required:Ka,fn_rejected:La,fn_url_success:za,fn_url_failed:Aa};if(CPWbot_bg.should_wait_for_document_complete(a,
b))return CPWbot_bg.wait_for_doc_complete(a,null,S,b),null;L("validate_cpw_success returns true, no wait ");return!0};this.validate_login_form=function(a,c){if(!c)return!1;var b={recipe:c,desc:"validate_login_success",fn_required:Ga,fn_rejected:Ha,fn_url_success:O,fn_url_failed:O};if(CPWbot_bg.should_wait_for_document_complete(a,b))return CPWbot_bg.wait_for_doc_complete(a,null,S,b),null;L("validate_login_success returns true, no wait ");return!0};this.validate_cpw_form=function(a,c){if(!c)return!1;
var b={recipe:c,desc:"validate_cpw_form",fn_required:Ea,fn_rejected:Fa,fn_url_success:O,fn_url_failed:O};if(CPWbot_bg.should_wait_for_document_complete(a,b))return CPWbot_bg.wait_for_doc_complete(a,null,S,b),null;L("validate_cpw_form returns true, no wait ");return!0};this.revert_password=function(a,c){if(!c)return!1;alert("REVERT: TODO");return!0};this.initiate=function(a,c,b,d){n="A";var e={},g=!1,h=!0;if(!c||!lploggedin)return g;if(b&&F&&"Csleep"!=b&&"Dsleep"!=b&&"Esleep"!=b&&"Bsleep"!=b)return L("currently sleeping, ignoring resumption at state=="+
b+" - make sure this is good"),g;var f=c.aid,j=c.recipe,p="undefined"!=typeof c.validate_result?c.validate_result:null;e.aid=f;"undefined"==typeof b?(b=0,K=e,ca=0,s(C,"["+(new Date).toString()+"] BEGIN")):(e=K,null===e&&(console.error("empty payload!"),e={aid:f}));console.log("A: INITIATE, start_state is "+b);"undefined"==typeof d&&(d=1);if(10<d)return L("cpwbot initiate: recursion_ctr exceeded"),!1;if("undefined"==typeof g_CS_tops[a])s(C,"Waiting for Website to finish loading ..."),L("cpwbot initiate: topdocnum["+
a+"] is not ready, retry"),setTimeout(function(){"A1"===b&&(L("initiate: restart A1->0"),b=0);CPWbot_bg.initiate(a,c,b,d+1)},900);else{L("cpwbot initiate: topdocnum["+a+"] = "+g_CS_tops[a]);F=!1;if("C"==b||"Csleep"==b||"Dsleep"==b||"D"==b||"E"==b||"F"==b||"D1"==b||"D2"==b||"D3"==b||"Esleep"==b||"Eretry"==b||"Epickup"==b||"Dpickup"==b||"Cpickup"==b)pass;else{if("B"==b&&da&&(verbose_log("calling reveal JS after B state"),y(a,j,ja),F=!1,f=oa(j)))return L("B sleeping "+f),F=!0,setTimeout(function(){CPWbot_bg.initiate(a,
c,"Bsleep",d+1)},f),!1;verbose_log("A1: check_is_logged_in, start_state was "+b);n="A1";f=null;if("A2"==b||"A3"==b||"A4"==b||"A5"==b||"B1"==b||"B"==b||"Bsleep"==b)f=!1,pass;else if("A1"==b)verbose_log("A1: check_is_logged_in / return from CS, returned "+p),f=p;else{f=this.check_is_logged_in(a,j,e);if(null===f)return verbose_log("A1: check_is_logged_in / CS callout "),null;verbose_log("A1: check_is_logged_in returns "+f+" no CS callout ")}if(f)console.log("USER IS ALREADY LOGGED IN, SKIP LOGIN STATE"),
s(C,"ALREADY LOGGED INTO WEBSITE"),pass;else{CPWbot_bg.setmsg_cpwbot_overlay(a,gs("Logging In MSG2"));verbose_log("A3: validate_login_form");n="A3";var m=null;if("A2"==b||"A4"==b||"A5"==b)m=!0;else if("B1"==b)m=!1;else if("A3"==b)verbose_log("A3: validate_login_form / return from CS, returned "+p),m=p;else{verbose_log("calling validate_login_form after "+b+" state");m=this.validate_login_form(a,j,e);if(null===m)return verbose_log("A3: validate_login_form / CS callout "),null;verbose_log("A3: validate_login_form returns "+
f+" no call to CS")}if(!m){if("B"==b||"Bsleep"==b||1<ca)return s(w,"LOGIN FORM EXPECTED, POST loadurl"),z=!0,this.alert("LOGIN FORM EXPECTED, POST loadurl"),A(a),g;ca++;verbose_log("B: GOTO LOGIN ");h=h&&this.navigate_to_login(a,j,e);if(!h)return h;verbose_log("B1: validate_login_form ");n="B1";m=null;if("B1"==b)verbose_log("B1: validate_login_form / return from CS, returned "+p),m=p;else if(m=this.validate_login_form(a,j,e),null===f)return verbose_log("B1: validate_login_form / CS callout "),null;
if(!m)return s(w,"LOGIN FORM EXPECTED BUT NOT FOUND"),z=!0,this.alert("LOGIN FORM EXPECTED BUT NOT FOUND"),A(a),g}console.log("A4: FILL LOGIN");n="A4";f=null;if("A2"==b||"A5"==b)pass;else if(f=ka(a,j,e),!f)return s(w,"FILL LOGIN FORM FAILED!"),z=!0,this.alert("FILL LOGIN FORM FAILED!"),A(a),g;console.log("A5: SUBMIT LOGIN");n="A5";if("A2"==b||"A5"==b)pass;else{f=la(a,j,e);if(!1===f)return s(w,"SUBMIT LOGIN FORM FAILED!"),z=!0,this.alert("SUBMIT LOGIN FORM FAILED!"),A(a),g;if(null===f){setTimeout(function(){b=
"A5";CPWbot_bg.initiate(a,c,b,d+1)},1100);return}}console.log("A2: validate_login_success ");n="A2";f=null;if("A2"==b)verbose_log("A2: validate_login_success / return from CS, returned "+p),f=p;else{f=this.validate_login_success(a,j,e);if(null===f)return verbose_log("A2: validate_login_success / CS callout "),null;verbose_log("A2: validate_login_success "+f+" no CS callout ")}if(!f)return s(w,"LOGIN TO WEBSITE FAILED!"),z=!0,this.alert("LOGIN TO WEBSITE FAILED!"),A(a),g}console.log("C: GOTO ACCTMGMT ");
CPWbot_bg.setmsg_cpwbot_overlay(a,gs("Navigating MSG3"));f={desc:"navigate_to_acctmgmt",payload:e,recipe:j,target_field:v(j,FN_NAVIGATE_TO_ACCTMGMT),target_js:q(j)+""+G(j),target_url:!j?null:j.acctmgmt_url};CPWbot_bg.should_wait_for_document_complete(a,f)?(L("wrapped navigate_to_acctmgmt around wait-for-document-complete"),f.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,CPWbot_bg.navigate_to_acctmgmt,f),h=null):(f.didcallout=!1,L("execute navigate_to_acctmgmt, no wait "),h=h&&this.navigate_to_acctmgmt(a,
f));if(!h)return h}"Cpickup"==b&&L("resume C-pickup");f=ma(j);Q&&(L("sleeping waiting for godot C"),f||(f=2500));if("Csleep"==b&&!Q||"Dsleep"==b||"D"==b||"E"==b||"F"==b||"D1"==b||"D2"==b||"D3"==b||"Esleep"==b||"Eretry"==b||"Epickup"==b||"Dpickup"==b)F=!1,pass;else if(f)return L("C sleeping "+f),F=!0,setTimeout(function(){CPWbot_bg.initiate(a,c,"Csleep",d+1)},f),!1;("C"==b||"Csleep"==b)&&fa&&y(a,j,G);if("D"==b||"Dsleep"==b||"Esleep"==b||"E"==b||"F"==b||"D1"==b||"D2"==b||"D3"==b||"Eretry"==b||"Epickup"==
b||"Dpickup"==b)pass;else if(h&&(console.log("D: REVEAL"),f={desc:"reveal_cpw",payload:e,recipe:j,target_field:v(j,FN_NAVIGATE_TO_CPW),target_js:I(j)+""+l(j),target_url:!j?null:j.cpw_url},CPWbot_bg.should_wait_for_document_complete(a,f)?(L("wrapped reveal_cpw around wait-for-document-complete"),f.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,CPWbot_bg.reveal_cpw,f),h=null):(f.didcallout=!1,L("execute reveal_cpw, no wait "),h=h&&this.reveal_cpw(a,f)),!h))return h;"Dpickup"==b&&L("resume D-pickup");
f=na(j);R&&(L("sleeping waiting for godot D"),f||(f=2500));if("Dsleep"==b&&!R||"D1"==b||"E"==b||"F"==b||"D2"==b||"D3"==b||"Esleep"==b||"Eretry"==b||"Epickup"==b)F=!1,pass;else if(f)return L("D sleeping "+f),F=!0,setTimeout(function(){CPWbot_bg.initiate(a,c,"Dsleep",d+1)},f),!1;("D"==b||"Dsleep"==b)&&ea&&y(a,j,l);console.log("D1: validate_cpw_form ");n="D1";f=null;if("E"==b||"F"==b||"D2"==b||"D3"==b||"Esleep"==b||"Eretry"==b||"Epickup"==b)pass;else if("D1"==b)verbose_log("D1: validate_cpw_form / return from CS, returned "+
p),f=p;else if(f=this.validate_cpw_form(a,j,e),null===f)return verbose_log("D1: validate_cpw_form / CS callout "),null;if("E"==b||"F"==b||"Esleep"==b||"Eretry"==b||"Epickup"==b)pass;else if(!f){n="D2";f=null;if("D3"==b)pass;else if("D2"==b)verbose_log("D2: validate_login_form / return from CS, returned "+p),f=p;else if(f=this.validate_login_form(a,j,e),null===f)return verbose_log("D2: validate_login_form / CS callout "),null;if(f||"D3"==b||"D4"==b){CPWbot_bg.setmsg_cpwbot_overlay(a,gs("Logging In MSG2"));
if("D3"!=b){if("D4"==b)pass;else{f=ka(a,j,e);if(!f)return s(w,"FILL LOGIN FORM [PW CHALLENGE] FAILED!"),this.alert("FILL LOGIN FORM [PW CHALLENGE] FAILED!"),z=!0,A(a),!1;n="D4";f=la(a,j,e);if(!1===f)return s(w,"SUBMIT LOGIN FORM [PW CHALLENGE] FAILED!"),z=!0,this.alert("SUBMIT LOGIN FORM [PW CHALLENGE] FAILED!"),A(a),g;if(null===f){setTimeout(function(){CPWbot_bg.initiate(a,c,b,d+1)},1100);return}}console.log("D3: validate_login_success ");n="D3";f=null;if("D3"==b)verbose_log("D3: validate_login_success / return from CS, returned "+
p),f=p;else{f=this.validate_login_success(a,j,e);if(null===f)return verbose_log("D3: validate_login_success / CS callout "),null;verbose_log("D3: validate_login_success "+f+" no CS callout ")}}pass}else return L("reveal cpw failed"),z=!0,s(w,"NAVIGATE TO CHANGE PASSWORD FORM FAILED!"),this.alert("NAVIGATE TO CHANGE PASSWORD FORM FAILED!"),A(a),g}if("E"==b||"F"==b||"Esleep"==b||"Epickup"==b)pass;else if(h&&(CPWbot_bg.setmsg_cpwbot_overlay(a,gs("Generate+Change MSG4")),console.log("E: TRIGGER"),f={desc:"trigger_cpw",
payload:e,recipe:j,target_field:v(j,FN_CPW_SUBMIT),target_js:ha(j)+""+ia(j),target_url:null},CPWbot_bg.should_wait_for_document_complete(a,f)?(L("wrapped trigger_cpw around wait-for-document-complete"),f.didcallout=!0,CPWbot_bg.wait_for_doc_complete(a,null,CPWbot_bg.trigger_cpw,f),h=null):(f.didcallout=!1,L("execute trigger_cpw, no wait "),h=h&&CPWbot_bg.trigger_cpw(a,f)),!h))return h;"Epickup"==b&&L("resume E-pickup");f=0;j?"undefined"!=typeof j.posttrigger_sleep&&(f=j.posttrigger_sleep):f=null;
M&&(L("sleeping waiting for godot E"),f||(f=2500));if("F"==b||"Esleep"==b&&!M)F=!1,pass;else if(f)return L("E sleeping "+f),F=!0,setTimeout(function(){CPWbot_bg.initiate(a,c,"Esleep",d+1)},f),!1;M=!1;if(h){console.log("F: VALIDATE");n="F";h=!0;if("F"==b)verbose_log("F: VALIDATE return from CS, returned "+p),h=p;else if(h=CPWbot_bg.validate_cpw_success(a,j,e),null===h)return verbose_log("F: VALIDATE callout to CS"),null;if(h){verbose_log("cpwbot initiate: validate cpw succeeded, now updating user record");
m=e;if(!j||!m)e=!1;else{e=!0;p=m.aid;console.log("cpwbot initiate: save_replace for aid="+p);h=W(p);f=lpdec(m.newpw);m=lpdec(m.curpw);if(h&&f&&m){h.pwprotect&&(e=!1);console.log("cpwbot initiate: calling changepw logic for aid="+p);var k={singleaid:p,newpw:f};e?changepw_wrapper(k):security_prompt(function(){changepw_wrapper(k)})}else verbose_log("no passwords to save? acct.aid = "+(h?h.aid:"null")+" cur="+(g_show_pw_in_logs||g_isadmin?m:"REDACTED")+" newpw="+(g_show_pw_in_logs||g_isadmin?f:"REDACTED"));
e=!0}e?(s(C,"SAVE AND REPLACE SUCCEEDED - HOPEFULLY"),aa=!0,CPWbot_bg.setmsg_cpwbot_overlay(a,gs("Success! MSG5")),this.alert("CPWBOT: SUCCESS!"),g=!0,e=lpdec(ga),p=lp_gettld_url(!j?null:j.login_url),verbose_log("remember to g_didchangepw for pw="+(g_show_pw_in_logs||g_isadmin?e:"REDACTED")+" tld="+p),remember_changed_pw(e,p)||verbose_log("save to g_didchangepw failed for pw="+(g_show_pw_in_logs||g_isadmin?e:"REDACTED")+" tld="+p),setTimeout(function(){CPWbot_bg.conditional_js_exec(a,j,ya)},1234)):
(s(w,"PASSWORD SAVE FAILED"),z=!0,this.alert("PASSWORD SAVE FAILED"))}else z=!0,s(w,"PASSWORD SAVE FAILED"),this.alert("PASSWORD CHANGE FAILED");A(a)}return g}};this.cpwbot_cs_finish_complete=function(a){verbose_log("cpwbot_cs_finish_complete on tabid="+a);t!=a?verbose_log("stale call: started up a new password change on different tab - ABORT - tabid=="+a+" g_pwchangetabid="+t):(CPWbot_bg.logout(),s(C,"["+(new Date).toString()+"] END"))};this.finish_cpwbot_validate_state=function(a,c,b,d,e){verbose_log("ENTERED finish_cpwbot_validate_state");
var g=!1,h=!1;if(t!=a)return verbose_log("finish_cpwbot_validate_state: !tabid, abort"),!1;if(c!=E)return verbose_log("finish_cpwbot_validate_state: ignoring stale request, current validate is "+J+"/"+E+", stale req is "+e+"/"+c+" "),!1;if(N&&!T)return N=!1,T=!0,L("finish_cpwbot_validate_state: reload1 extending timeout for "+e),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(a,loc_id,b,d,e)},validate_timeout),!1;verbose_log("finish_cpwbot_validate_state: closing out request "+e+"/"+
c);if(null===u)return verbose_log("finish_cpwbot_validate_state: dup, abort"),!1;if(null===g_CS[a])return lploggedin?(L("finish_cpwbot_validate_state: reload2 extending timeout for "+e),setTimeout(function(){CPWbot_bg.finish_cpwbot_validate_state(a,loc_id,b,d,e)},validate_timeout)):(verbose_log("finish_cpwbot_validate_state: tab "+a+" closed "),CPWbot_bg.panic()),!1;var f=sa(a);g_CS[a].length==u.length&&(h=!0);for(c=0;c<u.length;c++)if(u[c]){g=!0;break}h||verbose_log("finish_cpwbot_validate_state: sent out "+
g_CS[a].length+" messages, received "+u.length+" messages, skipped "+f+" frames");c=h=0;for(var j in k)k.hasOwnProperty(j)&&!this.skip_frame_by_score(j)&&(h++,u[j]&&c++);c<h&&console.warn("CASE : still waiting to hear from important frames, expected to hear from "+h+", heard from "+c);g||(j=JSON.parse(b),h=JSON.parse(d),0==j.length&&0<h.length&&(g=!0));B=u=null;g={aid:P,recipe:H,validate_result:g};console.log("finish_cpwbot_validate_state resumed initiate with state="+n);CPWbot_bg.initiate(a,g,n);
return!1};this.chk_cpw_resume=function(a,c){var b=!1;if(g_cpwbot&&n&&t==a&&"undefined"!=typeof g_CS_tops[a]&&g_CS_tops[a]==c)switch(console.log("resuming up pw change after loadurl/setdocm/getprefs msg from docnum="+c+" state="+n),n){case "A":CPWbot_bg&&CPWbot_bg.initiate(a,d);break;case "B":case "C":case "D":if(CPWbot_bg){var d={aid:P,recipe:H};console.log("call initiate with state="+n);CPWbot_bg.initiate(a,d,n)}else console.log("CPWbot object is gone?");b=!0;break;case "E":case "F":CPWbot_bg&&B&&
CPWbot_bg.retry_validate(a);break;case "A2":case "A3":CPWbot_bg&&B&&(L("interrupted by a page load/refresh, reissuing validate for state "+n),CPWbot_bg.retry_validate(a));break;case "A1":CPWbot_bg&&B&&(L("interrupted by a page load/refresh, reissuing validate for state "+n),u=[],sendCS(a,B,"all"));break;case "D1":n="D";CPWbot_bg?(d={aid:P,recipe:H},console.log("timedout validate, now calling initiate with state="+n),CPWbot_bg.initiate(a,d,n)):console.log("CPWbot object is gone?");b=!0;break;case 0:case "0":console.log("chk_cpw_resume() is called in initial state - ignoring");
b=!0;break;default:console.log("Unexpected state "+n),b=!1}else L("chk_cpw_resume called with unexpected input: state="+n+" tabid="+a+" g_pwchangetabid="+t+" docnum="+c+" topdoc="+g_CS_tops[a]);return b};this.cpwbot_validate_state_result_handler=function(a,c){var b=!1;if(CPWbot_bg&&t&&a==t){var d=c.docnum;if("undefined"!=typeof d&&CPWbot_bg&&null!==u){var e=JSON.parse(c.result);JSON.parse(c.rejected_fields);JSON.parse(c.required_fields);var g=null;c.result_obj&&(g=JSON.parse(c.result_obj));var h=
c.desc,f=c.id;L("received a "+h+" validate result from ["+a+"]["+d+"]["+c.url+"]["+c.docstate+"]["+c.state+"]="+e);if(J&&J!=h||E&&E!=f)L("unexpected validate msg - perhaps from the last validate call.... ignoring it"),L("got "+h+"/"+f+" expected "+J+"/"+E);else if(g&&(c.required_url&&s(C,"["+a+"]["+d+"] validate given success_url, result="+g.url_success_match+" matched success url = "+c.required_url),c.rejected_url&&s(C,"["+a+"]["+d+"] validate given bad_url, result="+g.url_failure_match+" matched failure url = "+
c.rejected_url),s(C,"["+a+"]["+d+"] "+h+" found "+g.num_ok_matches+"/"+g.num_okfields+" success fields, given "+g.num_badfields+" invalid fields and "+(g.found_bad_match?"found":"did not find")+" invalid fields "),0<g.num_ok_matches?ra(a,c):g.found_bad_match?ra(a,c):(g=c.docnum,f=c.url,null!==k&&((null===k[g]||"undefined"==typeof k[g])&&CPWbot_bg.clear_frame_score(a,g,f),k[g]+=-2))),u[d]=e,d=sa(a),g_CS[a].length==u.length&&(b=!0),verbose_log("["+a+"] "+h+" sent "+g_CS[a].length+" messages, heard from "+
u.length+", skipped "+d+" frames"),e||b)u=null,null===e&&(e=!1),b={aid:P,recipe:H,validate_result:e},B=null,L("resume initiate with state="+n),CPWbot_bg.initiate(a,b,n)}}};this.cpwbot_finish_ack_handler=function(a,c){if(null!==a&&c){sendCS(a,{cmd:"cpwbot_finish_ack"},"all");sendCS(a,{cmd:"hide_cpwbot_overlay"},"all");if(g_CS_tops[a]!=c.docnum){console.error("WTF : top "+g_CS_tops[a]+" but docnum is "+c.docnum);var b=getcsinfo(a,c.docnum),d=getcsinfo(a,g_CS_tops[a]);verbose_log("["+g_CS_tops+"] topdoc is "+
d.url);verbose_log("["+c.docnum+"] other doc is "+b.url);b.parent_docnum==b.docnum?verbose_log("CS table says that "+c.docnum+" is top"):d.parent_docnum==d.docnum?verbose_log("CS table says that "+g_CS_tops[a]+" is top"):verbose_log("CS table mismatch ? ")}CPWbot_bg.cpwbot_cs_finish_complete(a)}};this.cpwbot_skip_url=function(){return!1};this.logout=function(){E=J=B=K=H=P=n=null;ca=0;U=ga=t=null;z=aa=!1;k=null;T=N=!1;Z=null};this.initialize=function(a){t=a.tabid;H=a.recipe;P=a.aid;V="";n=0;U=null;
aa=M=z=!1;g_inner_text_response_fn=null;g_robots_txt&&sendCS(a.tabid,{cmd:"get_robots_txt"},g_CS_tops[a.tabid]);k={};T=N=!1;Z=null};this.pwchangetabid_is_still_valid=function(){if(!CPWbot_bg)return!1;var a=t;return null!==a&&g_CS&&"undefined"!=typeof g_CS[a]&&null!==g_CS[a]?!0:!1};this.panic=function(){this.alert("UNEXPECTED ERROR");verbose_log("UNEXPECTED ERROR, g_pwchangetabid == "+t);A(t);CPWbot_bg.cpwbot_cs_finish_complete(t)};this.setmsg_cpwbot_overlay=function(a,c){g_isfirefox?this.alert("todo"):
(sendCS(a,{cmd:"hide_cpwbot_overlay"},g_CS_tops[a]),ba(a,c))};this.initiate_on_complete=function(a,c,b){var d=null;if(!g_cpwbot||!CPWbot_bg||30<b)return s(w,"Timed out waiting for page to load.  Retry?"),CPWbot_bg.panic(),null;if("undefined"==typeof b||null===b)b=1;if(!Oa(c.recipe)){var d=W(c.aid),e="(null)";d&&d.url&&(e=d.url);s(w,"Error for recipe on aid="+c.aid+", url="+e);L("ERROR: premature abort, recipe failed validation");CPWbot_bg.panic();return null}var g=pa(c.recipe);g||(g=900);var h=g_CS_tops[a];
if(null!==h&&(d=getcsinfo(a,g_CS_tops[a]))&&"complete"==d.docstate)return d=b?b*g/1E3:0,isNaN(d)&&verbose_log("WTF NaN: ctr="+b+" url="+e+" aid="+aid),s(C,"Waited "+d+" seconds for document-complete before calling initiate"),ba(a,gs("Changing MSG1")),CPWbot_bg.initiate(a,c);ping(a);verbose_log("waiting for tabid "+a+" topdocnum="+h+" docstate="+(d?d.docstate:"null"));setTimeout(function(){CPWbot_bg.initiate_on_complete(a,c,b+1)},g);return!0};this.get_user_debug_messages=function(){return V};this.show_user_debug_messages=
function(){this.alert(V)};var qa=0,C=1,w=3;this.userlog=function(a,c){return s(a,c)};this.click_ack_handler=function(a,c){var b=c.msgid,d=c.found;L("[T:"+a+"][D:"+c.docnum+"] cpwbot click_ack on "+c.id_value+" found="+d+" url="+c.url+" docstate="+c.docstate+" pwchangestate="+c.pwchangestate);if(Z!=b)return console.error("response for last click request overlaps current click-wait, ignoring it, found="+d),d&&console.error("Bad Mojo"),!0;d&&(M&&(M=!1),$&&($=!1),R&&(R=!1),Q&&(Q=!1));return!0};this.fill_ack_handler=
function(a,c){L("["+a+"]["+c.docnum+"] cpwbot fill ack on "+c.id_value+" found="+c.found+" url="+c.url);return!0};this.check_for_robots=function(){};this.check_robot_txt=function(a,c){if(g_robots_txt){if(!a)return!0;if(null===c)g_tmp_recipe=a;else{for(var b,d=0,e=c.split("\n"),g=!1,h=!1,d=0;d<e.length;d++){b=e[d];if(0==b.length&&""==b||"\r"==b)h=g=!1;"#"!=b.charAt(0)&&(0==b.indexOf("User-agent: LastPass")?g=!0:0==b.indexOf("User-agent: *")?g=!0:0==b.indexOf("Disallow: /")&&(h=!0))}return g&&h?!1:
!0}}};this.score_frame=function(a,c){var b=c.docnum,d=c.url,e,g=0,h=lp_gettld_url(d);getname_url(d);var f=0,j="doubleclick.net appads.com crwdcntrl.net googleadservices.com quantserve.com questionmarket.com advertising.com zedo.com checkm8.com zvents.com doubleclick.com yldmgrimg.net optmd.com casalemedia.com scorecardresearch.com quotemedia.com tacoda.net daylife.com brightcove.com wibiya.com clickability.com stats.com google-analytics.com adfusion.com 2mdn.net adsonar.com everyclick.com shopica.com yeah.com vectorportal.com cnomy.com phpbb.com tracking101.com revsci.net revsci.com atdmt.com mmismm.com googlesyndication.com 247realmedia.com pointroll.com bluekai.com serving-sys.com vizu.com cleanprint.com outbrain.com tweetmeme.com visiblemeasures.com starwave.com kaango.com gabriels.net overture.com yieldmanager.net 2mdn.com eyewonder.com imgdownloads.com liverail.com adnxs.com addthis.com addthiscdn.com imshopping.com adtech.de 2o7.net glanceguide.com performgroup.com undertone.com undertonevideo.com martiniadnetwork.com chartbeat.net omtrdc.net zoomflow.com crowdscience.com imrworldwide.com fwmrm.net tremormedia.com webtrends.com adzerk.net adzerk.com qubitproducts.com maxymiser.net maxymiser.com newrelic.com mathtag.com adroll.com criteo.com liveperson.com getclicky.com sitemeter.com displaymarketplace.com yieldmanager.com media6degrees.com betrad.com 360yield.com adpredictive.com burstnet.com adtechus.com adsafeprotected.com turn.com contextweb.com p-td.com lijit.com rubiconproject.com ru4.com admeld.com openx.net pubmatic.com localyokelmedia.com qnsr.com wrating.com audienceiq.com mydas.mobi mopub.com visualrevenue.com adsymptotic.com admob.com adtrking.com 4dsply.com adshostnet.com adziff.com 33across.com vindicosuite.com securepaths.com taboola.com trk4.com crwdcntrl.com connexity.com connexity.net".split(" "),
p="ads.cnn.com metrics.post-gazette.com ads.nwsource.com adbox.sina.com.cn ads.sina.com.cn ad.afy11.net avatar.cnn.com ads.cnn.com metrics.apple.com trailers.apple.com metrics.philly.com adsatt.espn.go.com".split(" "),m=["facebook.com/plugins","http://static.ak.facebook.com/connect/xd_arbiter","https://s-static.ak.facebook.com/connect/xd_arbiter","http://platform.twitter.com/widget"];g_CS_tops&&g_CS_tops[a]==c.docnum&&(g=100);for(e=0;e<j.length;e++)if(h==j[e]){g=-100;f=1;break}if(!f)for(e=0;e<p.length;e++)if(0<=
d.indexOf(p[e])){g=-100;f=1;break}if(!f)for(e=0;e<m.length;e++)if(0<=d.indexOf(m[e])){g=-100;break}k&&(k[b]=g);return g};this.score_topdoc=function(a,c,b){if(null===k)return!1;(null===k[c]||"undefined"==typeof k[c])&&CPWbot_bg.clear_frame_score(a,c,b);k[c]+=100;return!0};this.clear_frame_score=function(a,c){if(null===k)return!1;k[c]=0;return!0};this.reset_scores=function(){k=null;return!0};this.skip_frame_by_score=function(a){if(null===k||null===a)return!0;L("skip? docnum ="+a+" score="+k[a]);return 0>
k[a]};this.recompute_scores_for_tab=function(){return!0};this.retry_validate=function(a,c){null===c&&(c="all");B&&(u=[],sendCS(a,B,c))};this.wait_for_doc_complete=function(a,c,b,d,e){var g,h=pa(d.recipe);h||(h=900);var f=g_CS_tops[a];null===c&&(c=f);if(null!==c&&(g=getcsinfo(a,c))&&"complete"==g.docstate)return g=e?e*h/1E3:0,isNaN(g)&&verbose_log("WTF NaN: recursion_ctr="+e+" url="+url+" aid="+aid),s(C,"Waited "+g+" seconds for document-complete on [tabid:"+a+"][docnum:"+c+"] to execute "+d.desc),
ba(a,gs("Waiting... MSG6")),b(a,d);ping(a);verbose_log("waiting for tabid "+a+" topdocnum="+f+" passed_docnum="+c+" docstate="+(g?g.docstate:"null"));c!=f&&(console.error("edge case - top docnum changed due to page reload?  will wait for that instead"+c+"!="+f),c=f);setTimeout(function(){CPWbot_bg.wait_for_doc_complete(a,c,b,d,e+1)},h);return!0};this.should_wait_for_document_complete=function(a,c){if(null===a||!c)return!1;var b=c.desc,d=c.recipe,e=!0,g=c.fn_url_failed,h=c.fn_url_success,f=c.fn_required,
j=c.fn_rejected,f=f?f(d):[],d=j?j(d):[],j=c.target_url,k=c.target_field,m=c.target_js;if(!("undefined"==typeof j||null===j)||!("undefined"==typeof k||null===k)||!("undefined"==typeof m||null===m))e=!1;if(e){if(0==f.length&&0==d.length&&!h&&!g)return L("should_wait returns false, WARN: "+b+" has no field or url criteria defined to validate against"),!1}else if(!j&&!k&&!m)return L("should_wait returns false, no wait criteria, "+b),!1;L("should_wait returns true for "+b+" is_validate="+e);return!0};
this.force_validate_retry=function(a){N=a};return!0}
function get_recipe_for_url(v,I){var l=lp_gettld_url(v),q=null;if("facebook.com"==l)q=fbfb;else if("google.com"==l||"gmail.com"==l)q=gmgm;else if("tumblr.com"==l)q=tmtm;else if("amazon.com"==l)q=amam;else if("twitter.com"==l)q=twtw;else if("pizzahut.com"==l)q=pizzahut;else if("chron.com"==l)q=huhu;else if("reddit.com"==l)q=redditj;else if("nordstrom.com"==l)q=nordstrom;else if("washingtonpost.com"==l)q=wapo;else if("dailykos.com"==l)q=kos;else if("ebay.com"==l)q=ebay;else if("yahoo.com"==l)q=yahoo;
else if("bild.de"==l||0==v.indexOf("https://secure.mypass.de")&&0<v.indexOf("bild.de"))q=bild;else if("netrot.net"==l)q=testrig;else if("espn.com"==l||0<=v.indexOf("espn.go.com"))q=espn;else{g_isfirefox?(l=LP.lpMakeRequest,q=LP.lp_base):(l=lpMakeRequest,q=base_url);l(q+"get_recipe.php","url="+encodeURIComponent(v),function(l){if(4==l.readyState){if(200==l.status&&(null!=l.responseXML&&null!=l.responseXML.documentElement)&&(l=l.responseXML.documentElement.getElementsByTagName("result"),0<l.length))if(l=
l[0].getAttribute("recipe"),""==l)CPWbot_bg.alert("NOT IMPLEMENTED YET");else{I(JSON.parse(l));return}I(null)}},function(){I(null)});return}I(q)};
